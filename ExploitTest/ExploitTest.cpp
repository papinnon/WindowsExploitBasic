// ExploitTest.cpp : Defines the entry point for the console application.
//

#include "stdafx.h"
#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include <Windows.h>
void shell()
{
	puts("hacked\n");
	exit(0);
}
void fun()
{
	char password[6] = "ABCDE";
	char str[6];
	FILE * fp;
	fp = fopen("password.txt", "r");
	fscanf(fp, "%s", str);
	fclose(fp);
	str[5] = '\0';
	if (strcmp(str, password) == 0)
		puts("OK.\n");
	else
		puts("No.\n");
	return;
}

int format()
{
	//printf("%160c%hhn");
	int a;
	printf("aaaa%n\n",&a);
	printf("%d", a);
	return a;
}
void PrintAddress()
{
	HMODULE hmod = LoadLibrary(L"Kernel32.dll");
	void * pvAddress = GetProcAddress(hmod, "LoadLibraryW");
	printf("Kernel32.dll module: %p\n", hmod);
	printf("LoadLibraryW func: %p\n", pvAddress);
	printf("PrintAddress: %p\n", PrintAddress);
	FreeLibrary(hmod);
}
int volatile _tmain(int argc, _TCHAR* argv[])
{
	FILE * fp = fopen("password.txt", "w+"); 
	fwrite("12345678123456\x00\x00\x00\x10\x40\x00\x00\x10\x40\x00", 24, 1, fp);
	fclose(fp);
	fp = 0;
	//fun();
	//format();
	//PrintAddress();
	puts("call successful\n"); 
	if (fp)
		shell();
	return 0;
}

